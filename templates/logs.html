{% extends "base.html" %}

{% block content %}
<div class="header-section">
  <h1>System Logs</h1>
  <p>Detailed transaction history (Last 500 records)</p>
</div>

<!-- Audit Logs Section -->
<h2 style="margin-top: 1.5rem; margin-bottom: 1rem; font-size: 1.25rem; color: var(--text-muted);">Admin Audit Trail
</h2>
<div class="card" style="margin-bottom: 2rem;">
  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>Time</th>
          <th>User</th>
          <th>Action</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        {% for audit in audit_logs %}
        <tr>
          <td style="white-space: nowrap;">
            {{ audit.timestamp.strftime('%Y-%m-%d %H:%M') }}
          </td>
          <td>
            <span class="badge" style="background: var(--bg-input);">{{ audit.username }}</span>
          </td>
          <td>
            <span class="badge" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6;">{{ audit.action }}</span>
          </td>
          <td>{{ audit.details }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" style="text-align: center; color: var(--text-muted); padding: 1rem;">No audit logs yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Transaction Logs Section -->
<h2 style="margin-bottom: 1rem; font-size: 1.25rem; color: var(--text-muted);">Stock Movements</h2>
<div class="card">
  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Time</th>
          <th>Type</th>
          <th>Doc #</th>
          <th>Item</th>
          <th>Brand</th>
          <th>Location</th>
          <th>Expiry</th>
          <th>Qty</th>
          <th>Plts</th>
          <th>Worker</th>
          <th>Remarks</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td>{{ log.date.strftime('%Y-%m-%d') if log.date else log.timestamp.strftime('%Y-%m-%d') }}</td>
          <td>{{ log.timestamp.strftime('%H:%M:%S') }}</td>
          <td>
            <span class="badge {% if log.type == 'IN' %}green{% else %}red{% endif %}">
              {{ log.type }}
            </span>
          </td>
          <td>{{ log.doc_number or '-' }}</td>
          <td>{{ log.item.name if log.item else '<Deleted>' }} <small>({{ log.item.sku if log.item else '-' }})</small>
          </td>
          <td>{{ log.item.brand if log.item else '-' }}</td>
          <td><span class="badge">{{ log.location.name if log.location else '<Deleted>' }}</span></td>
          <td class="expiry-{{ check_expiry(log.expiry) }}">{{ log.expiry or '-' }}</td>
          <td
            style="color: {% if log.type == 'IN' %}var(--success){% else %}var(--danger){% endif %}; font-weight: 600;">
            {{ "+" if log.type == 'IN' else "-" }}{{ log.quantity | abs }}
          </td>
          <td>{{ log.pallets or '-' }}</td>
          <td>{{ log.worker_name or (log.user.username if log.user else 'System') }}</td>
          <td>{{ log.remarks or '-' }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="12" style="text-align: center;">No logs found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<style>
  .badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 0.8rem;
  }

  .badge.green {
    background: rgba(34, 197, 94, 0.2);
    color: #22c55e;
  }

  .badge.red {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
  }
</style>
{% endblock %}